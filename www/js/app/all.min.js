window.onload=function(){var a=new Life,b=document.getElementById("start"),c=document.getElementById("refresh"),d=document.getElementsByName("speed"),e=d.length;a.init();a.countDays=document.getElementById("countDays");a.countDead=document.getElementById("countDead");a.countLive=document.getElementById("countLive");b.onclick=function(){var c=(b.getAttribute("class")||"").split(" "),d=c.indexOf("btn-primary");0<=d?(c.push("btn-danger"),this.value="Стоп ◼",a.start(a)):(d=c.indexOf("btn-danger"),c.push("btn-primary"),
this.value="Старт ▶",a.stop());0<=d&&delete c[d];this.setAttribute("class",c.join(" "))};c.onclick=function(){a.refresh()};for(c=function(){var b={slow:1E3,normal:500,fast:100},c=this.value;a.speed=b[c]?b[c]:b.normal;null!==a.timer&&(a.stop(),a.start())};e-=1;)d[e].onclick=c};
function Board(){this.height=this.width=550;this.cellsY=this.cellsX=50;this.layer=new Kinetic.Layer;this.grid=new Grid;this.stage=new Kinetic.Stage({container:"container",width:this.width,height:this.height});this.drawRect=function(a,b){return new Kinetic.Rect({x:10*a,y:10*b,width:10,height:10,fill:"#876D78"})};this.drawCells=function(a){this.layer.removeChildren();for(var b in a)for(var c in a[b]){if(void 0==a[b][c]){console.warn("board.drawCells",b,c,a);return}if(!0==a[b][c]){var d=this.drawRect(b,
c);this.layer.add(d)}}}}function Grid(){this.layer=new Kinetic.Layer;this.draw=function(){var a,b,c;this.layer.removeChildren();for(a=0;50>=a;a+=1)b=10*a,c=new Kinetic.Line({points:[0,b,500,b],stroke:"gray",strokeWidth:0.5,lineCap:"round",lineJoin:"round"}),this.layer.add(c),b=new Kinetic.Line({points:[b,0,b,500],stroke:"gray",strokeWidth:0.5,lineCap:"round",lineJoin:"round"}),this.layer.add(b);return this.layer}}
function Life(){this.timer=null;this.board=new Board;this.cells=[];this.countL=this.countD=this.count=0;this.speed=500;this.countLive=this.countDead=this.countDays=void 0;this.init=function(){this.cells=this.seed(this.cells);this.board.stage.add(this.board.grid.draw())};this.live=function(){var a=this.life(this.cells);this.board.stage.removeChildren();this.board.drawCells(a);this.board.stage.add(this.board.grid.draw());this.board.stage.add(this.board.layer);this.board.layer.removeChildren();this.countDays.innerHTML=
this.count;this.countDead.innerHTML=this.countD;this.countLive.innerHTML=this.countL;this.count+=1;this.cells=a};this.refresh=function(){this.stop();this.countL=this.countD=this.count=0;this.cells=this.seed([]);this.start()};this.start=function(){var a=this;this.timer&&this.stop();this.timer=window.setInterval(function(){a.live()},this.speed)};this.stop=function(){null!==this.timer&&(window.clearInterval(this.timer),this.timer=null)};this.getRandomInt=function(a,b){return Math.floor(Math.random()*
(b-a+1))+a};this.seed=function(a){a=this.feel(a);for(var b in a)for(var c in a[b])a[b][c]=1===this.getRandomInt(1,10);return a};this.feel=function(a){var b,c;for(b=0;b<this.board.cellsX;b+=1){a[b]=[];for(c=0;c<this.board.cellsY;c+=1)a[b][c]=null}return a};this.point=function(a){var b=parseInt(a,10);0>b&&-4<b?b=this.board.cellsX+b:b>this.board.cellsX-1&&b<this.board.cellsX+2&&(b=b+1-this.board.cellsX);(0>b||49<b)&&console.warn(a,b);return b};this.neighbourCount=function(a,b,c){var d=0;b=this.point(b);
c=this.point(c);var e,f;for(e=-1;2>e;e+=1)for(f=-1;2>f;f+=1){var g=this.point(b+e),h=this.point(c+f);(g!==b||h!==b)&&!0==a[g][h]&&d++}return d};this.life=function(a){for(var b in a){this.countL=this.countD=0;for(var c in a[b]){var d=this.neighbourCount(a,b,c);if(void 0==a[b][c]){console.warn("life.life undefined",a);return}this.countD+=9-d;this.countL+=d;a[b][c]=!0==a[b][c]?2==d||3==d?!0:!1:3==d}}return a}};
